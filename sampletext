chatHistory.lastChild.remove(); // remove thinking message

let answer = "";

if (typeof data === "string") {
    answer = data;
} else if (Array.isArray(data.answer)) {
    answer = data.answer.map(item => item.text || "").join("\n").trim();
} else if (typeof data.answer === "string") {
    answer = data.answer;
} else if (data.message) {
    answer = data.message;
} else if (data.response) {
    answer = data.response;
} else {
    answer = JSON.stringify(data);
}

addMessage(answer || "Sorry, I couldn't find an answer.", "bot");