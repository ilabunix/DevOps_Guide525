if "embedding" in doc:
    embedding = doc["embedding"]

    # Ensure it's a list
    if not isinstance(embedding, list):
        print(f"â›” Skipping document {doc['id']}: embedding is not a list")
        return

    # Normalize to 1536 dims
    if len(embedding) < 1536:
        embedding += [0.0] * (1536 - len(embedding))  # Pad
    elif len(embedding) > 1536:
        embedding = embedding[:1536]  # Truncate

    # Cast to float32
    doc["embedding"] = [float(x) for x in embedding]